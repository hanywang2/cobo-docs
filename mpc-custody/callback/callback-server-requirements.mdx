---
title: "Callback Server Requirements"
icon: ""
description:
---

## HTTP API

The callback server is an HTTP server that supports the following endpoints:

* Path
  * /v1/check
* Method
  * POST
* Body
  * Encoded with x-www-form-urlencoded&#x20;

## HTTP Request Parsing&#x20;

The TSS Node will follow the steps below to send the HTTP request:

* Generate CallbackRequest
* Serialize CallbackRequest to derive CallbackRequestJsonString
* Use CallbackRequestJsonString as the JWT payload and sign it using its RSA private key to create a JWT
* Submit the HTTP POST request via an HTML form with TSS\_JWT\_MSG as the key and JWT as the value

The callback server will follow the steps below once it receives the HTTP request:

* Retrieve the data in the HTTP POST request using TSS\_JWT\_MSG as the key and the JWT as the value
* Use the TSS Node’s RSA public key to validate the signed JWT
* Retrieve the payload in the JWT and deserialize it using CallbackRequest
* Deserialize the meta field to retrieve the information in the request

## Risk Control

You'll need to perform a risk control for each CallbackRequest based on your organization’s business and security requirements to further validate the request.

## HTTP Response

The callback server will send the HTTP response as follows: &#x20;

* Generate CallbackResponse
* Serialize CallbackResponse to derive CallbackResponseJsonString
* Use CallbackResponseJsonString as the JWT payload and sign it using its RSA private key to create a JWT
* Use the JWT as the HTTP response and return it to the TSS Node

## CallbackRequest Description

| Parameter       | Type   | Description                                                                                                                                                                         |
| --------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| request\_id     | string | Unique ID of the callback request                                                                                                                                                   |
| request\_type   | int    | <p>The types of callback requests, which will be an enum:</p><p></p><p>TypeKeyGen     = 1</p><p>TypeKeySign    = 2</p><p>TypeKeyReshare = 3</p>                                 |
| request\_detail | string | The details of the callback request; each type of the callback requests corresponds to a different request\_detail structure; the format is a serialized JSON string                |
| extra\_info     | string | Other information associated with the callback request; each type of the callback requests corresponds to a different extra\_info structure; the format is a serialized JSON string |

When request\_type == TypeKeyGen, request\_detail is as follows:


| Parameter | Type      | Description                                                                        |
| --------- | --------- | ---------------------------------------------------------------------------------- |
| threshold | int       | Signature threshold                                                                |
| node\_ids | \[]string | Node IDs associated with the generation of all MPC key shares under the MPC wallet |
| curve     | int       | Signature algorithm that has been used; 0: curve type of SECP256K1                 |

extra\_info:

| Parameter | Type   | Description                                                          |
| --------- | ------ | -------------------------------------------------------------------- |
| cobo\_id  | string | <p>Unique ID of the key generation (KeyGen) request  </p><p></p> |

When request\_type == TypeKeySign, request\_detail is as follows:&#x20;

| Parameter         | Type      | Description                                                           |
| ----------------- | --------- | --------------------------------------------------------------------- |
| group\_id         | string    | Group ID used during transaction signing                              |
| root\_pub\_key    | string    | MPC root extended public key                                          |
| used\_node\_ids   | \[]string | <p></p><p>Node IDs used during transaction signing</p><p></p> |
| bip32\_path\_list | \[]string | Address paths (BIP32)                                                 |
| msg\_hash\_list   | \[]string | Hashes to be signed                                                   |

extra\_info:

| Parameter            | Type                     | Description                                                                                                                                                                                                                                                  |
| -------------------- | ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| cobo\_id             | string                   | Unique ID of the transaction signing (KeySign) request                                                                                                                                                                                                       |
| api\_request\_id     | string                   | <p>(Optional) Request ID of the withdrawal request; </p><p></p><p>If the request is initialized via API, the value should be the same as request_id; </p><p></p><p>If the request is initialized via Cobo Custody Web, the field should be blank</p> |
| transaction\_type    | TrasactionTypeEnum       | Please refer to TransactionTypeEnum                                                                                                                                                                                                                          |
| operation            | TransactionOperationEnum | Please refer to TransactionOperationEnum                                                                                                                                                                                                                     |
| coin                 | string                   | Asset name                                                                                                                                                                                                                                                   |
| decimal              | int                      | Decimal precision                                                                                                                                                                                                                                            |
| from\_address        | string                   | Address from which assets are withdrawn                                                                                                                                                                                                                      |
| amount               | string                   | <p>(Optional) Transaction amount, which contains decimal places (e.g. one bitcoin is divisible to eight decimal places, and 100000000 represents 1 BTC)</p><p></p>                                                                                       |
| to\_address          | string                   | Deposit address                                                                                                                                                                                                                                              |
| to\_address\_details | json                     | (Optional) List of deposit addresses; applicable to the UTXO model; the value must meets the JSON structure of list\[ToAddressDetail]                                                                                                                        |
| fee                  | int                      | (Optional) For BTC transaction, this field returns the transaction fees per byte; unit: satoshi                                                                                                                                                              |
| gas\_price           | int                      | <p>(Optional) Gas fees; appcailbe to ETH; unit: GWei</p><p></p>                                                                                                                                                                                          |
| gas\_limit           | int                      | (Optional) Gas limit; applicable to ETH                                                                                                                                                                                                                      |
| extra\_parameters    | json                     | <p>Additional parameters for the transaction; for more information, please refer to the description of create_transaction   </p><p></p>                                                                                                                  |
| replace\_cobo\_id    | string                   | (Optional) ID of a Cobo transaction that has been designated as RBF                                                                                                                                                                                          |
| api\_key             | string                   | (Optional) API\_KEY of the withdrawal request initialized through API                                                                                                                                                                                        |
| spender              | string                   | (Optional) Email information of the withdrawer; applicable to Cobo Custody Web                                                                                                                                                                               |
| raw\_tx              | list\[RawTx]             | Raw transaction data                                                                                                                                                                                                                                         |
| note                 | string                   | Transaction remarks                                                                                                                                                                                                                                          |

ToAddressDetail:

| Parameter   | Type   | Description                                                                                                                                                 |
| ----------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| to\_address | string | Withdrawal address                                                                                                                                          |
| amount      | string | <p>Transaction amount, which contains decimal places (e.g. one bitcoin is divisible to eight decimal places, and 100000000 represents 1 BTC)</p><p></p> |

extra\_parameters:


| Parameter           | Type         | Description                                                                                                             |
| ------------------- | ------------ | ----------------------------------------------------------------------------------------------------------------------- |
| inputs\_to\_spend   | list\[Input] | Unspent Transaction Output (UTXO) to spend; this only applies in UTXO type of blockchains (e.g. bitcoin)                |
| inputs\_to\_exclude | list\[Input] | Unspent Transaction Output (UTXO) to exclude from spending; this only applies in UTXO type of blockchains (e.g bitcoin) |

Input:

| Parameter | Type   | Description           |
| --------- | ------ | --------------------- |
| tx\_hash  | string | Transaction hash      |
| vout\_n   | int    | Transaction index/no. |

TransactionTypeEnum:

| Value    | Description     |
| -------- | --------------- |
| WITHDRAW | Asset wthdrawal |

RawTx:

| Parameter | Type   | Description                          |
| --------- | ------ | ------------------------------------ |
| raw\_tx   | string | Hex-encoded transaction information  |

When request\_type == TypeKeyReshare, request\_detail is as follows：

| Parameter       | Type      | Description                                                                            |
| --------------- | --------- | -------------------------------------------------------------------------------------- |
| old\_group\_id  | string    | Old Group ID                                                                           |
| root\_pub\_key  | string    | MPC extended public key                                                                |
| curve           | int       | Signature algorithm that has been used; 0: curve type of SECP256K1                     |
| used\_node\_ids | \[]string | Selected Node IDs from the previous group that have been used for soft key recovery    |
| old\_threshold  | int       | Previous signature threshold                                                           |
| new\_threshold  | int       | New Signature Threshold                                                                |
| new\_node\_ids  | \[]string | New Node IDs associated with the generation of all MPC key shares under the MPC wallet |

extra\_info:

| Parameter | Type   | Description                                             |
| --------- | ------ | ------------------------------------------------------- |
| cobo\_id  | string | Unique ID of the soft key recovery (KeyReshare) request |

## CallbackResponse Description&#x20;

| Parameter   | Type   | Description                                                                                                                                                                                                                                                                                                                                                                            |
| ----------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| status      | int    | Status; 0: callback server is normal; other values: callback server has an error                                                                                                                                                                                                                                                                                                       |
| request\_id | string | Request ID of the callback; the value must be the same as request\_id in CallbackRequest                                                                                                                                                                                                                                                                                               |
| action      | string | <p>Instructions for task execution, which will be an enum: [APPROVE, REJECT, WAIT]</p><p></p><p>APPROVE: task should be executed; </p><p></p><p>REJECT: task should be rejected, and the reason can be retrieved from the error field; </p><p></p><p>WAIT: instruction fails to be given and the TSS Node should re-send the request to the callback server</p><p></p> |
| error       | string | <p>Error message;</p><p></p><p>If the returned status is not 0, it indicates an error within the callback server</p><p></p><p>If the returned status is 0 and action returns a “REJECT”, it indicates the reason for task rejection</p><p></p>                                                                                                                             |
